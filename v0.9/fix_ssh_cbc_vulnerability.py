#!/usr/bin/env python
# -*- coding: utf-8 -*-

import os

def fix_ssh_cbc_vulnerability():
    sshd_config_path = '/etc/ssh/sshd_config'
    cbc_algorithms = [
        '3des-cbc',
        'aes128-cbc',
        'aes192-cbc',
        'aes256-cbc',
        'blowfish-cbc',
        'cast128-cbc'
    ]
    
    new_sshd_config_lines = []

    with open(sshd_config_path, 'r') as f:
        lines = f.readlines()

        for line in lines:
            if line.strip().startswith('Ciphers'):
                for algorithm in cbc_algorithms:
                    if algorithm in line:
                        line = line.replace(algorithm, '')
                if line.strip().endswith(','):
                    line = line.rstrip(',') + '\n'
            new_sshd_config_lines.append(line)

    with open(sshd_config_path, 'w') as f:
        f.writelines(new_sshd_config_lines)
    
    print('CBC mode ciphers have been disabled in [{}].'.format(sshd_config_path))
    print('Please remember to restart the SSH service for the changes to take effect.')

def main():
    fix_ssh_cbc_vulnerability()

if __name__ == '__main__':
    main()
